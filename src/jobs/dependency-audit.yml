description: >
  Job runs OWASP Dependency Check

executor: default

parameters:
  dependency_check_project_name:
    type: string
    description: "Name used by OWASP Dependency Check"

steps:
  - checkout
  - attach_workspace:
      at: .
#  - restore_cache:
#      keys:
#        - v12-dependencies-<< parameters.cache_var >>{{ checksum "package.json" }}
#        - v12-dependencies-<< parameters.cache_var >>
  - run:
      name: Run OWASP Dependency Check
      command: |
        docker run --name owasp-dependency-check --volume $(pwd)/dependency-check-data:/usr/share/dependency-check/data:z --volume $(pwd):/src:z owasp/dependency-check:<< parameters.dependency_check_version >> --scan /src --format "ALL" --project "<< parameters.dependency_check_project_name >>"  --out /report
        docker cp owasp-dependency-check:/report odc-reports
        ls
        ls dependency-check-data
#  - save_cache:
#      paths:
#        - node_modules
#      key: v12-dependencies-<< parameters.cache_var >>{{ checksum "package.json" }}
  - persist_to_workspace:
      root: .
      paths:
        - odc-reports
